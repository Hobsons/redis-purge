# redis-purge
Purge redis keys matching a search value

'''
$ go run scrubRedis.go
Usage:

[REDIS_ADDR=...]           \
[DELETE_MATCHING_KEYS=yes] \
[REQUIRED_MATCH_COUNT=n]   \
[SIZE_THRESHOLD=x]         \
	/var/folders/m4/_bpm7k_57qj05m8lq4wcgj7w0000gp/T/go-build500872978/b001/exe/scrubRedis [value]

Deletes all keys with a given value if run with DELETE_MATCHING_KEYS=yes
or DELETE_MATCHING_KEYS=y in the environment, otherwise lists the keys with
the given value.

If SIZE_THRESHOLD is set to a number of bytes in the environment, only keys
with values at least as large as SIZE_THRESHOLD will be considered.

If REQUIRED_MATCH_COUNT is a number >0, then keys are selected if the value
contains the search pattern _at least_ that many times.
exit status 1
'''


example:


'''
$ go build ./redis-purge.go

$ DELETE_MATCHING_KEYS=y REDIS_ADDR=session-cache.ore.starfishsolutions.com:6379 REQUIRED_MATCH_COUNT=3 SIZE_THRESHOLD=10000 ./redis-purge '<saml2p:AuthnRequest'
> deleting keys with value matching Search="<saml2p:AuthnRequest" (size>=10000 bytes) (match >= 3 occurrences)
DELETE 1021E27775BB6807EB110AEB752A18B7
DELETE B84D1907C8C6BBB3615EE57FF7F8A6D8
DELETE 0D1F39461DB508DD48E7CA3A51523B28
DELETE 9FBE99D7095477E088D29F1C73058D25
DELETE 695147A8D0B62DF08793700BB738F001
DELETE 503B41E5E8BD8283AE5EB17D3A583C9C
DELETE E6AF8553F2C5DC9CA28FDA4906B1F4EF
DELETE C675F57FA42FE511817B678F2BB681E2
DELETE 519FE1BE11BB52DD2AAB2EF1E9B68921
DELETE 4F9EDE598B946D424D5B42891DDE1B23
DELETE 5CA1D59E7186A7716CF516399C3820D0
DELETE 5AF0018D37FE5E13FB791B8D7A336FD3
DELETE 9C6A76DD2A73765F828EA5520EE222B9
DELETE 962CA47144CF7D1240B08A690649A5D4
DELETE 64B53473CDA5EA8B35B4307FACB09AE3
DELETE 61AAC09C2E2D7017C317071F19893B75
DELETE 65113E535D48420316B93FE951961FD9
DELETE CCF420277D2AEF881C8354D7EF2496B5
DELETE F5FEF4E58E02AE6DD1DC7F51264AB11B
DELETE 0E2B32D89F9DB5A093A5651DB31652DC
DELETE AC85F86F9B3514F151D9CD7849A4AE25
DELETE 7CE6967CF33F1F7A045EC84444D56923
DELETE 941AC97A39B7F69443FD87AFC49E85E3
DELETE C4C03825B1770C07CBB97863029CCBD2
DELETE 2287D6CE24DE52DD727601E5C6BFFADB
DELETE E48C8193AEDE852FA55DD82C89E1AB39
DELETE 4D91699B7C65D24939CC8586635F7A35
DELETE CFEEDECC5F7DDF181E7EEF372A9F963D
DELETE 8632382627C00E8EEAA0174C09A1EAD6
DELETE 8123F357EF26FDBC662724EF14DFA3F1
DELETE 60B1A238AF82F6F4B69EE361469207DB
DELETE 5CFBA13A65A9140AC889100E884A0D7D
DELETE F0D17EAD68A8911B21E9147F0FCC225D
DELETE 5BBBFA3D5A1DC79CC66D642ECE15E09A
DELETE CFE0CC400D3E9342CB18DF98D1D19087
DELETE 376F36AE11C7D92369C4C5F567D2531E
DELETE 5AF3381FDA829DAAE33E56C84C3CCEA6
DELETE 92EEC08E325C2777A366AAD31F89B43F
DELETE E4AFF1F805A19FA51FEBECBCE5843A8F
DELETE A883791D3626BCAD9D693AE63B055A15
DELETE A344054BFEAA674CE8DE91FA3B1DEE5B
DELETE 868D98DD9EAF138C28E00BFB53A41BC6
DELETE 5D82B1802B5F455030E9EA9160A82FD4
DELETE A6A8ACA3ADBC0927CC90AF64862B1366
DELETE F036E1F775B4C95E495C1667A7B4611F
DELETE 41C4B1AA0324705A6DA776B6204585EA
DELETE 1D4C00EA15C4AD84663D0F6EBBF4FE30
DELETE 2F13788B4D5077A5B773F61B75DE5F5C
DELETE 5E6E816B002198C8E65043C0CA9C9428
DELETE B9048F8F33B94FD35C4857C70741A75A
DELETE 98313A0DE2D8586F00A22E2F1C94BE7E
DELETE 33E06B30575843179991FF8E210B8BAD
DELETE DBE2378E7185760086BD9D559AF474A9
DELETE 4A0272BB87F444E308D50633C7AC2B90
DELETE FDEE92EABB212D1E2E9C9EBCCE700C38
DELETE A7E6BE6F07DF66AB238B49A003890369
DELETE D5F446D2294A573C143FE45AF2522D2C
DELETE F0A9673A39FA5BF3D584BA0D15C5E16F
DELETE 725C46EB74E7F6182D9A22A8A4DD8D97
DELETE 6F74B9B0CB0CBD97B2039FC56D74FCCC
DELETE F90AAC84E477E74C422E9A5AF5E0BAFC
DELETE E36048ACE8FC5902831189DB78166D67
DELETE 26C34198B6FF77BCEBEE2D76F05A342B
DELETE 0E1C22FD6A45F683DB24ED2E5B3E72B4
DELETE 4E152A55B0E84007E7ED17313C5694A8
DELETE 8E935D1014D18FD64ADD31F3AF84EB58
DELETE FDABD8A68BC0C8DED211C9D58D1A15D2
DELETE EA75E6CD53BFD1CD3876752CC351BF97
DELETE A5AF94D75C68BCCF36EA1F73EC6C1BD4
DELETE 7D87F9D00C4E01E17938BE59C6474AFD
DELETE E82C5E0C7EC4354C994C11740C3B735C
DELETE 3E88B78CA31F8E0448F1D3CE4A65B83E
DELETE 83976A5B6F57640D1D5876B5A396DF98
DELETE 03E27A3DE11DE76779CB6FF3C76F5DC7
DELETE A77CC09A4B270F79BBB7A1B46A4E7C7B
> deleted 75 keys (147289133 total size) matching Search="<saml2p:AuthnRequest" (size>=10000 bytes) (match >= 3 occurrences), 0 keys failed delete
'''
